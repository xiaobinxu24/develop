
-----------------------------------------------------------------------------------------------
## All program
```

                       +------------+  hasConfig   +-----------+  hasConfig   +-----------------+     #=========#
                   --> |   uninit   | -----------> |           | -----------> |   Restart ss    | --> H  next2  H
                       +------------+              |           |              +-----------------+     #=========#
                         |                         |           |
                         | notConfig               | pingcheck |
                         v                         |           |
                       +------------+              |           |  notConfig   +-----------------+     #=========#
                       |  queryip   | -----------> |           | -----------> |   pingupload    | --> H  next1  H
                       +------------+              +-----------+              +-----------------+     #=========#
                         ^            No result      |
                         +---------------------------+


next1:

#================#     +------------+  OK   +-----------+     +-----------------+     #=========#
H     next1      H --> | pingupload | ----> | saveLocal | --> |   Restart ss    | --> H  next2  H
#================#     +------------+       +-----------+     +-----------------+     #=========#
                         |
                         | Fail
                         v
                       +------------+
                       |  queryip   |
                       +------------+

next2:

                                                             Fail
                                                           +----------+
                                                           v          |
#========#     +------------+     +--------------+  OK   +--------------+     #=============#
H next 2 H --> | Restart ss | --> | checkOutside | ----> | onlineNotify | --> H figure next H
#========#     +------------+     +--------------+       +--------------+     #=============#
                                    |
                                    | Fail
                                    v
                                  +--------------+
                                  |   queryip    |
                                  +--------------+

figure next:


                                                           OK
                                           +-------------------------------------------------+
                                           v                                                 |
#=============#     +--------------+     +---------------+     +------+  Bind   +---------+  |
H figure next H --> | clearTraffic | --> | waitNextTime  | --> | Bind | ------> | queryip |  |
#=============#     +--------------+     +---------------+     +------+         +---------+  |
                                           |                                                 |
                                           |                                                 |
                                           v                                                 |
                                         +---------------+                                   |
                                         | uploadTraffic | ----------------------------------+
                                         +---------------+

```

-----------------------------------------------------------------------------------------------
## Check Outside

```
                         +-----------------------------------------------------------------------------------------------------------------------+
                         |                                                                                                                       |
                         |                                                                                                                       |
                         |       +-----------------------------------------------------------------------------------------------+               |
                         |       |                                                                                               |               |
                         |       |        less counts 2                                                                          |               |
                         |       |    +----------------------------------------------------------+                               |               |
                         v       v    v                                                          |                               |               |
                       +----------------+     +-----------------+     +---------+  (all)Fail   +------------+  counts more 2   +--------------+  |
                   --> |                | --> | jp.kfrouter.cn  | --> |         | -----------> | Restart SS | ---------------> | WaitNextTime | -+
                       |                |     +-----------------+     |         |              +------------+                  +--------------+
                       |                |                             |         |               (anyone)OK                       ^
                       |   CheckStart   |                             | OK/Fail | -----------------------------------------------+
                       |                |                             |         |
+----------------+     |                |     +-----------------+     |         |
| us.kfrouter.cn | <-- |                | --> | sgp.kfrouter.cn | --> |         | <+
+----------------+     +----------------+     +-----------------+     +---------+  |
  |                      |                                              ^          |
  |                      |                                              |          |
  |                      v                                              |          |
  |                    +------+                                         |          |
  |                    | t.co | ----------------------------------------+          |
  |                    +------+                                                    |
  |                                                                                |
  +--------------------------------------------------------------------------------+

```

